<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Sprintia - Historique Statut</title>
    <meta charset="utf-8">
    <meta name="description" content="Sprintia : Des outils gratuits pour analyser et optimiser vos entra√Ænements.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../../CSS/style.css">
    <link rel="icon" type="image/svg+xml" href="../../Assets/icons-sprintia/Logo-Sprintia-Head-Clair.svg" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/svg+xml" href="../../Assets/icons-sprintia/Logo-Sprintia-Head-Sombre.svg" media="(prefers-color-scheme: dark)">

    <link rel="manifest" href="../../manifest.json">

    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sprintia">
    <link rel="apple-touch-icon" href="../../Assets/icons-sprintia/icon-ios.png">
    
    <script src="../../Param√®tres/script_themes.js"></script>
</head>  

<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <a href="../../index.html" id="a-logo">Sprintia</a>
            </div>
            <ul class="links">
                <li>
                    <a href="../../index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a class="actif" href="../outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="../../Param√®tres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Param√®tres
                    </a>
                </li>
            </ul>
            <div class="burger-menu-button">
                <i class="fs-icon_menu"></i>
            </div>
        </div>

        <div class="burger-menu">
            <ul class="links">
                <li>
                    <a href="../../index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a class="actif-burger-menu" href="../outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="../../Param√®tres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Param√®tres
                    </a>
                </li>
            </ul>
        </div>
    </header>

    <div class="conteneur-de-outil">
        <h1>Historique Statut</h1>
        <p class="text" id="text-informatif">
            Sprintia n'a pas encore assez de donn√©es pour afficher votre historique de statut. Veuillez 
            <a href="statut_analyses.html" class="lien">ajouter un statut</a>.
        </p>

        <div class="conteneur-cards-workout" id="liste-statut"></div>
        <div class="conteneur-centrage-marge">
            <button id="button_afficher_plus" onclick="Historique()">
                Afficher plus
            </button>
        </div> 

    </div>
    
    <footer>
        <div class="conteneur-lien-footer">
            <a class="a_title">Cat√©gories</a>
            <a class="a_footer" href="../../index.html">Accueil</a>
            <a class="a_footer" href="../outils.html">Outils</a>
            <a class="a_footer" href="../../Param√®tres/parametres.html">Param√®tres</a>
            <a class="a_footer" href="../../Param√®tres/Historique versions/historique versions.html">Historique des versions</a>
            <a class="a_footer" href="../../Param√®tres/Th√®mes/themes.html">Th√®mes</a>
        </div>
           
        <div class="conteneur-lien-footer">             
            <a class="a_title">Outils conseill√©s</a>
            <a class="a_footer" href="../Charge d'entra√Ænement/charge_entrainement.html">Charge d'entra√Ænement</a>
            <a class="a_footer" href="../Estimation VO2max/estimation_VO2max.html">Estimation VO‚ÇÇmax</a>
            <a class="a_footer" href="../Niveau de course √† pied/niveau_course.html">Niveau de course √† pied</a>
        </div>
            
        <div class="conteneur-lien-footer">
            <a class="a_title">Autres</a>
            <a class="a_footer" href="../../Param√®tres/Licence/Licence.html">Licence (¬© 2026 Sprintia)</a>
            <a class="a_footer" href="../../Param√®tres/Confidentialit√©/confidentialite.html">Politique de confidentialit√©</a>
        </div>
    </footer>

    <!-- Pour le burger menu -->
    <script src="../../Assets/base-js/base.js"></script>
    
    <!-- Import biblioth√®que pour simplifier le code de indexed db -->
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="../../Assets/base-js/DB_config.js"></script> <!-- Connexion bdd -->

    <script>
        function ReturnDate(DateStatut) {
            let DateEuropeen = ""

            DateStatut = DateStatut.split("-")
            // Inversion de la date de "2026-01-12" √† "12-01-2026"
            DateEuropeen = DateStatut[2] + "-" + DateStatut[1] + "-" + DateStatut[0]
            return DateEuropeen
        }

        // init pour le logo dynamique
        let Timer1 = 0
        let Timer2 = 0

        async function Init() {
            // animation du dynamic logo pour message au user
            const ParamURL = window.location.search
            const TableauSeparation = ParamURL.split("?")
            
            if (TableauSeparation.length > 1) {
                let MessageDynamicLogo = ""
                if (TableauSeparation[1] == "Vacances") {
                    MessageDynamicLogo = "Profitez bien üå¥"
                } else if (TableauSeparation[1] == "Blessure") {
                    MessageDynamicLogo = "Bon repos ü§ï"
                } else if (TableauSeparation[1] == "Malade") {
                    MessageDynamicLogo = "Bon courage üò∑"
                } else if (TableauSeparation[1] == "Suspendre") {
                    MessageDynamicLogo = "Pause activ√©e ‚è∏Ô∏è"
                } else{
                    MessageDynamicLogo = "C'est reparti üî•"
                }
                    
                // timeout remis a 0 (suppresion plutot)
                clearTimeout(Timer1)
                clearTimeout(Timer2)
                document.getElementById("a-logo").classList.remove("return", "pin-message")
                
                // petite r√©compense pour le user
                document.getElementById("a-logo").classList.add("pin-message")

                document.getElementById("a-logo").textContent = MessageDynamicLogo;

                Timer1 = setTimeout(() => { 
                    document.getElementById("a-logo").classList.add("return") // a r√©-ajoute une class pour qu'il y est une animation de retour
                    document.getElementById("a-logo").textContent = "Sprintia"; // on raffiche Sprintia
                }, 2500); // on laisse le message pendant 2,5s pour que le user est le temps de le lire

                Timer2 = setTimeout(() => {
                    // remise √† l'√©tat initial, on supprime les 2 class qu'on a mis d√®s la fin du setTimeout au dessus
                    document.getElementById("a-logo").classList.remove("return")
                    document.getElementById("a-logo").classList.remove("pin-message")
                }, 3100) // dur√©e choisis √† la main
            }
            
            return
        }

        // on stocke les datas dans un tableau
        let HistoriqueComplet = []
        let NbCardsWorkoutAfficher = 0

        async function recupData() {
            // Recup de l'historique
            let HistoriqueDB = await db.statut_analyse.toArray() // recup de toutes les datas

            // Trier par date 
            HistoriqueDB.sort((element1, element2) => { // En js on peut comparer 2 dates comme des maths
                if (element1.date < element2.date) return 1
                if (element1.date > element2.date) return -1
            })

            HistoriqueDB.forEach(element => {
                HistoriqueComplet.push(element)
            });

            // Cacher le text comme quoi il n'y a pas de statut enregistrer
            if (HistoriqueComplet.length > 0) {
                document.getElementById("text-informatif").style.display = "none"
            }
            if (HistoriqueComplet.length <= 12) {
                document.getElementById("button_afficher_plus").style.display = "none"
            }

            await Historique()

            return
        }

        async function Historique() {
            // Cacher le text comme quoi il n'y a pas de statut enregistrer
            if (HistoriqueComplet.length <= 0) {
                document.getElementById("button_afficher_plus").style.display = "none"
            }
            // Cacher le bouton si il n'y a plus d'element a charger
            if (HistoriqueComplet.length <= NbCardsWorkoutAfficher) {
                document.getElementById("button_afficher_plus").style.display = "none"
            }

            const ConteneurCardsStatut = document.getElementById("liste-statut")
    
            // Coupage des datas pr le nb limite de cards
            let HistoriqueNecessaire = HistoriqueComplet.slice(NbCardsWorkoutAfficher, NbCardsWorkoutAfficher+12)
            NbCardsWorkoutAfficher += 12

            // Creation structure HTML
            HistoriqueNecessaire.forEach(elementBDD => {
                const CardStatut = document.createElement("div")

                CardStatut.classList.add("cards-history-workout")

                // Inversion de la date de "2026-01-12" √† "12-01-2026"
                let DateEuropeen = ReturnDate(elementBDD.date)

                let StructureHTML = `          
                    <div class="data-workout-column">
                        <p class="name-workout">
                            Statut : ${elementBDD.statut}
                        </p>
                        <p class="sport-date-workout">
                            ${DateEuropeen}
                        </p>
                    </div>
                    `
                
                if (elementBDD.raison == null) {
                    StructureHTML += `
                    <div class="data-workout-paire">
                        <p class="muscles-workout">
                            Vous n'avez pas enregistr√© de raison.
                        </p>
                    </div>
                    `
                } else {
                    StructureHTML += `
                    <div class="data-workout-paire">
                        <p class="muscles-workout">
                            ${elementBDD.raison}
                        </p>
                    </div>
                    `
                }

                StructureHTML += `
                    <div class="action-button-card-workout">
                        <button>
                            <i class="fs-icon_supprimer"></i>
                            Supprimer
                        </button>
                    </div>
                    `

                CardStatut.innerHTML = StructureHTML

                let BoutonSupprimer = CardStatut.querySelector(".fs-icon_supprimer").parentElement // parent element pour ne pas prendre que l'icone
                        
                // Ajout de la logique pour la suppresion
                BoutonSupprimer.addEventListener("click", async () => { // Ajout d'une "action" au bouton
                    // Demande de confirmation avant
                    if (confirm(`Supprimer ce statut "${elementBDD.statut}" ?`)) {
                        await db.statut_analyse.delete(elementBDD.id) // supprimer la data de la bdd
                        CardStatut.remove() // supprimer la ligne
                        // on r√©initialise le dynamique logo
                        clearTimeout(Timer1)
                        clearTimeout(Timer2)
                        document.getElementById("a-logo").classList.remove("return", "pin-message")

                        // petite r√©compense pour le user
                        document.getElementById("a-logo").classList.add("pin-message")

                        document.getElementById("a-logo").textContent = "Supprim√© üóëÔ∏è";

                        Timer1 = setTimeout(() => { 
                            document.getElementById("a-logo").classList.add("return") // a r√©-ajoute une class pour qu'il y est une animation de retour
                            document.getElementById("a-logo").textContent = "Sprintia"; // on raffiche Sprintia
                        }, 2500); // on laisse le message pendant 2,5s pour que le user est le temps de le lire

                        Timer2 = setTimeout(() => {
                            // remise √† l'√©tat initial, on supprime les 2 class qu'on a mis d√®s la fin du setTimeout au dessus
                            document.getElementById("a-logo").classList.remove("return")
                            document.getElementById("a-logo").classList.remove("pin-message")
                        }, 3100) // dur√©e choisis √† la main

                        const NbCardStatut = document.querySelectorAll(".cards-history-workout")
                        
                        if (NbCardStatut.length == 0) { // si il n'y a pas de card alors on remet le message comme quoi il faut ajouter des datas
                            document.getElementById("text-informatif").textContent = "Chargement..." // on pr√©cise que la page va se recharger par la suite
                            document.getElementById("text-informatif").style.display = "block"
                            document.getElementById("button_afficher_plus").style.display = "none"
                            location.reload()
                        }

                    }
                })

                ConteneurCardsStatut.appendChild(CardStatut)

            });
            return
        }

        window.addEventListener("DOMContentLoaded", () => {
            Init()
            recupData()
        })
    </script>

    
    <!-- Pour avoir les statistiques de visite du site -->
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>