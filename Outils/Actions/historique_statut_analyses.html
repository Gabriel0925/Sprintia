<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Sprintia - Historique Statut</title>
    <meta charset="utf-8">
    <meta name="description" content="Sprintia : Des outils gratuits pour analyser et optimiser vos entraînements.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../../CSS/style.css">
    <link rel="icon" type="image/svg+xml" href="../../Assets/icons-sprintia/Logo-Sprintia-Head-Clair.svg" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/svg+xml" href="../../Assets/icons-sprintia/Logo-Sprintia-Head-Sombre.svg" media="(prefers-color-scheme: dark)">

    <link rel="manifest" href="../../manifest.json">

    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sprintia">
    <link rel="apple-touch-icon" href="../../Assets/icons-sprintia/icon-ios.png">
    
    <script src="../../Paramètres/script_themes.js"></script>
</head>  

<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <a href="../../index.html">Sprintia</a>
            </div>
            <ul class="links">
                <li>
                    <a href="../../index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a class="actif" href="../outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="../../Paramètres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Paramètres
                    </a>
                </li>
            </ul>
            <div class="burger-menu-button">
                <i class="fs-icon_menu"></i>
            </div>
        </div>

        <div class="burger-menu">
            <ul class="links">
                <li>
                    <a href="../../index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a class="actif-burger-menu" href="../outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="../../Paramètres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Paramètres
                    </a>
                </li>
            </ul>
        </div>
    </header>

    <div class="conteneur-de-outil">
        <h1>Historique Statut</h1>
        <p class="text" id="text-informatif">
            Sprintia n'a pas encore assez de données pour afficher votre historique de statut. Veuillez 
            <a href="statut_analyses.html" class="lien">ajouter un statut</a>.
        </p>

        <div class="conteneur-cards-workout" id="liste-statut"></div>
    </div>
    
    <footer>
        <div class="conteneur-lien-footer">
            <a class="a_title">Catégories</a>
            <a class="a_footer" href="../../index.html">Accueil</a>
            <a class="a_footer" href="../outils.html">Outils</a>
            <a class="a_footer" href="../../Paramètres/parametres.html">Paramètres</a>
            <a class="a_footer" href="../../Paramètres/Historique versions/historique versions.html">Historique des versions</a>
            <a class="a_footer" href="../../Paramètres/Thèmes/themes.html">Thèmes</a>
        </div>
           
        <div class="conteneur-lien-footer">             
            <a class="a_title">Outils conseillés</a>
            <a class="a_footer" href="../Charge d'entraînement/charge_entrainement.html">Charge d'entraînement</a>
            <a class="a_footer" href="../Estimation VO2max/estimation_VO2max.html">Estimation VO₂max</a>
            <a class="a_footer" href="../Niveau de course à pied/niveau_course.html">Niveau de course à pied</a>
        </div>
            
        <div class="conteneur-lien-footer">
            <a class="a_title">Autres</a>
            <a class="a_footer" href="../../Paramètres/Licence/Licence.html">Licence (© 2026 Sprintia)</a>
            <a class="a_footer" href="../../Paramètres/Confidentialité/confidentialite.html">Politique de confidentialité</a>
        </div>
    </footer>

    <!-- Pour le burger menu -->
    <script src="../../Assets/base-js/base.js"></script>
    
    <!-- Import bibliothèque pour simplifier le code de indexed db -->
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="../../Assets/base-js/DB_config.js"></script> <!-- Connexion bdd -->
    <script>
        function ReturnDate(DateStatut) {
            let DateEuropeen = ""

            DateStatut = DateStatut.split("-")
            // Inversion de la date de "2026-01-12" à "12-01-2026"
            DateEuropeen = DateStatut[2] + "-" + DateStatut[1] + "-" + DateStatut[0]
            return DateEuropeen
        }

        async function Historique() {
            // Recup de l'historique
            let HistoriqueDB = await db.statut_analyse.toArray() // recup de toutes les datas

            // Trier par date 
            HistoriqueDB.sort((element1, element2) => { // En js on peut comparer 2 dates comme des maths
                if (element1.date < element2.date) return 1
                if (element1.date > element2.date) return -1
            })

            // Cacher le text comme quoi il n'y a pas de statut enregistrer
            if (HistoriqueDB.length > 0) {
                document.getElementById("text-informatif").style.display = "none"
            }

            const ConteneurCardsStatut = document.getElementById("liste-statut")
            
            // Remise à 0 du conteneur
            ConteneurCardsStatut.innerHTML = ""

            // Creation structure HTML
            HistoriqueDB.forEach(elementBDD => {
                const CardStatut = document.createElement("div")

                CardStatut.classList.add("cards-history-workout")

                // Inversion de la date de "2026-01-12" à "12-01-2026"
                let DateEuropeen = ReturnDate(elementBDD.date)

                let StructureHTML = `          
                    <div class="data-workout-column">
                        <p class="name-workout">
                            Statut : ${elementBDD.statut}
                        </p>
                        <p class="sport-date-workout">
                            ${DateEuropeen}
                        </p>
                    </div>
                    `
                
                if (elementBDD.raison == null) {
                    StructureHTML += `
                    <div class="data-workout-paire">
                        <p class="muscles-workout">
                            Vous n'avez pas enregistré de raison.
                        </p>
                    </div>
                    `
                } else {
                    StructureHTML += `
                    <div class="data-workout-paire">
                        <p class="muscles-workout">
                            ${elementBDD.raison}
                        </p>
                    </div>
                    `
                }

                StructureHTML += `
                    <div class="action-button-card-workout">
                        <button>
                            <i class="fs-icon_supprimer"></i>
                            Supprimer
                        </button>
                    </div>
                    `

                CardStatut.innerHTML = StructureHTML

                let BoutonSupprimer = CardStatut.querySelector(".fs-icon_supprimer").parentElement // parent element pour ne pas prendre que l'icone
                        
                // Ajout de la logique pour la suppresion
                BoutonSupprimer.addEventListener("click", async () => { // Ajout d'une "action" au bouton
                    // Demande de confirmation avant
                    if (confirm(`Supprimer ce statut "${elementBDD.statut}" ?`)) {
                        await db.statut_analyse.delete(elementBDD.id) // supprimer la data de la bdd
                        CardStatut.remove() // supprimer la ligne
                    }
                    location.reload()
                })

                ConteneurCardsStatut.appendChild(CardStatut)

            });
            return
        }

        window.addEventListener("DOMContentLoaded", () => {
            Historique()
        })
    </script>

    
    <!-- Pour avoir les statistiques de visite du site -->
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>