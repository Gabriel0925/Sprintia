<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Sprintia</title>
    <meta charset="utf-8">
    <meta name="description" content="Sprintia : Des outils gratuits pour analyser et optimiser vos entra√Ænements.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="CSS/style.css">
    <link rel="icon" type="image/svg+xml" href="Assets/icons-sprintia/Logo-Sprintia-Head-Clair.svg" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/svg+xml" href="Assets/icons-sprintia/Logo-Sprintia-Head-Sombre.svg" media="(prefers-color-scheme: dark)">

    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sprintia">
    <link rel="apple-touch-icon" href="Assets/icons-sprintia/icon-ios.png">

    <!-- Pour les th√®mes -->
    <script src="Param√®tres/script_themes.js"></script>
</head>

<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <a href="index.html">Sprintia</a>
            </div>
            <ul class="links">
                <li>
                    <a class="actif" href="index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a href="Outils/outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="Param√®tres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Param√®tres
                    </a>
                </li>
            </ul>
            <div class="burger-menu-button">
                <i class="fs-icon_menu"></i>
            </div>
        </div>

        <div class="burger-menu">
            <ul class="links">
                <li>
                    <a class="actif-burger-menu" href="index.html">
                        <i class="fs-icon_accueil"></i>
                        Accueil
                    </a>
                </li>
                <li>
                    <a href="Outils/outils.html">
                        <i class="fs-icon_outils"></i>
                        Outils
                    </a>
                </li>
                <li>
                    <a href="Param√®tres/parametres.html">
                        <i class="fs-icon_parametres"></i>
                        Param√®tres
                    </a>
                </li>
            </ul>
        </div>
    </header> 
    
    <div class="conteneur-about-marge"> 
        <h1>Accueil</h1>

        <div class="conteneur-mise-avant" id="banniere-accueil">
            <p>
                Sprintia est con√ßu pour vous aider avant et apr√®s un entra√Ænement gr√¢ce √† des algorithmes 100% gratuits.
            </p>
        </div>

        <div class="conteneur-mise-avant" id="section-jrm">
            <div class="zone-jrm">
                <p class="title-jrm" id="nom-coach">
                    JRM Coach :
                </p>
                <p class="interpretation-jrm">
                    Chargement...
                </p>
            </div>
        </div>

        <h2>Actions rapides</h2>

        <div class="conteneur-content-scrolling">
            <div class="conteneur-scrolling">

                <a href="Outils/Actions/ajouter_entra√Ænement.html">
                    <div class="shorcut first">
                        <div class="img" id="icone-add">
                            <i class="fs-icon_add"></i>
                        </div>
                        <p class="text-shorcut">
                            Ajouter un entra√Ænement
                        </p>
                    </div>
                </a>

                <a href="Outils/Actions/historique_entrainement.html">
                    <div class="shorcut">
                        <div class="img" id="icone-historique">
                            <i class="fs-icon_historique"></i>
                        </div>
                        <p class="text-shorcut">
                            Historique entra√Ænement
                        </p>
                    </div>
                </a>

                <a href="Outils/Actions/statut_analyses.html">
                    <div class="shorcut">
                        <div class="img" id="icone-pause">
                            <i class="fs-icon_pause"></i>
                        </div>
                        <p class="text-shorcut">
                            Statut d'analyse
                        </p>
                    </div> 
                </a>

            </div>
        </div>

        <h2 id="outils recent">Outils conseill√©s</h2>
        <p class="text" id="info-bulle">
            Vous pouvez √©pingler vos 3 outils pr√©f√©r√©s sur la page d'accueil. Pour ce faire, rendez vous dans l'onglet 'Outils' et cliquez sur l'√©pingle de l'outil correspondant.
        </p>
        <div class="conteneur-outil-recent">

            <a href="Outils/Charge d'entra√Ænement/charge_entrainement.html" class="L1">
                <div class="card-outil-recent">
                    <i class="fs-icon_charge_entrainement" id="I1"></i>
                    <p class="text-outil-recent" id="P1">Charge d'entra√Ænement</p>
                </div>
            </a>

            <a href="Outils/Estimation VO2max/estimation_VO2max.html" class="L2">
                <div class="card-outil-recent">
                    <i class="fs-icon_VO2MAX" id="I2"></i>
                    <p class="text-outil-recent" id="P2">Estimation VO¬≤max</p>
                </div>
            </a>
            
            <a href="Outils/Niveau de course √† pied/niveau_course.html" class="L3">
                <div class="card-outil-recent">
                    <i class="fs-icon_niveau_course" id="I3"></i>
                    <p class="text-outil-recent" id="P3">Niveau de course √† pied</p>
                </div>
            </a>

        </div>

        <h2>Activit√© r√©cente (3 sem.)</h2>
        <p class="text">
            Ce graphique permet de suivre votre r√©gularit√© en comparant votre temps total d'entra√Ænement par semaine.
        </p>
        <div class="chart-container" id="conteneur-graphique">
            <!--"aria-label" pr l'accesssibilit√© pr decrire a ceux qui ne voit pas-->
            <canvas id="barCanvas" aria-label="chart" role="img"></canvas>
        </div>

        <h2>Derniers entra√Ænements</h2>
        <p class="text" id="text-pas-entrainement">
            Vous n'avez pas encore enregistr√© d'entra√Ænement.
        </p>

        <div class="container-recent-workout"></div> <!-- Remplis en JS -->

        <div class="conteneur-centrage-marge">
            <button id="button_afficher_plus" onclick="location.href='Outils/Actions/historique_entrainement.html'">
                <i class="fs-icon_add"></i>
                Afficher plus
            </button>
        </div>


        <div class="conteneur-mise-avant" id="banniere-tips">
            <p id="tips">
                Chargement...
            </p>
        </div> 

    </div>
    
    <footer>
        <div class="conteneur-lien-footer">
            <a class="a_title">Cat√©gories</a>
            <a class="a_footer" href="index.html">Accueil</a>
            <a class="a_footer" href="Outils/outils.html">Outils</a>
            <a class="a_footer" href="Param√®tres/parametres.html">Param√®tres</a>
            <a class="a_footer" href="Param√®tres/Historique versions/historique versions.html">Historique des versions</a>
            <a class="a_footer" href="Param√®tres/Th√®mes/themes.html">Th√®mes</a>
        </div>
           
        <div class="conteneur-lien-footer">             
            <a class="a_title">Outils conseill√©s</a>
            <a class="a_footer" href="Outils/Charge d'entra√Ænement/charge_entrainement.html">Charge d'entra√Ænement</a>
            <a class="a_footer" href="Outils/Estimation VO2max/estimation_VO2max.html">Estimation VO‚ÇÇmax</a>
            <a class="a_footer" href="Outils/Niveau de course √† pied/niveau_course.html">Niveau de course √† pied</a>
        </div>
            
        <div class="conteneur-lien-footer">
            <a class="a_title">Autres</a>
            <a class="a_footer" href="Param√®tres/Licence/Licence.html">Licence (¬© 2026 Sprintia)</a>
            <a class="a_footer" href="Param√®tres/Confidentialit√©/confidentialite.html">Politique de confidentialit√©</a>
        </div>
    </footer>
    
    <!-- Pour le burger menu -->
    <script src="Assets/base-js/base.js"></script>

    <!-- Import de la biblioth√®que pr le graphique -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>   
    <!-- Import biblioth√®que pour simplifier le code de indexed db -->
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="Assets/base-js/DB_config.js"></script> <!-- Connexion bdd -->

    <!-- Pour les 3 derniers entrainements -->
    <script>
        function ReturnDate(DateWorkout) {
            let DateEuropeen = ""

            DateWorkout = DateWorkout.split("-")
            // Inversion de la date de "2026-01-12" √† "12-01-2026"
            DateEuropeen = DateWorkout[2] + "-" + DateWorkout[1] + "-" + DateWorkout[0]
            return DateEuropeen
        }

        function HTMLCard(CardWorkout, NameWorkout, SportWorkout, DateWorkout, DureeWorkout) {
            let StructureHTML = `          
                <a href="Outils/Actions/historique_entrainement.html">
                        <p class="name-workout">
                            ${NameWorkout}
                        </p>
                        <p class="sport-date-workout">
                            ${SportWorkout} ¬∑ ${DateWorkout}
                        </p>
                        <p class="duree">
                            Dur√©e : <strong>${DureeWorkout}</strong>
                        </p>
                </a>
            `

            CardWorkout.innerHTML = StructureHTML 

            let CardWorkoutHTML = CardWorkout

            return CardWorkoutHTML
        }

        async function AfficherData() {
            // on recup les datas
            let HistoriqueDB = await db.entrainement.toArray()

            // Trier par date 
            HistoriqueDB.sort((element1, element2) => { // En js on peut comparer 2 dates comme des maths
                if (element1.date < element2.date) return 1
                if (element1.date > element2.date) return -1
            })

            // on recup les datas necessaire
            let TableauNameWorkout = HistoriqueDB.map(elementDB => elementDB.nom).slice(0, 3) 
            let TableauSport = HistoriqueDB.map(elementDB => elementDB.sport).slice(0, 3)
            let TableauDateWorkout = HistoriqueDB.map(elementDB => elementDB.date).slice(0, 3)
            let TableauDureeWorkout = HistoriqueDB.map(elementDB => elementDB.duree).slice(0, 3)

            if (TableauNameWorkout.length <= 0) {
                // on cache la secction si il y a pas de datas
                document.querySelector(".container-recent-workout").style.display = "none"
                document.getElementById("button_afficher_plus").style.display = "none" // on cache le bouton
            } else { // si il y a des datas
                document.getElementById("text-pas-entrainement").style.display = "none" // on cache le text comme quoi il n'y a pas d'entrainement
                // initialisation pour la boucle
                let compteur = 0
                let SportWorkout = 0
                let DateWorkout = 0
                let DureeWorkout = 0
                const ConteneurCardsWorkout = document.querySelector(".container-recent-workout") // recup√©ration du conteneur des cards

                TableauNameWorkout.forEach(NameWorkout => {
                    // maj des variables en fonction de l'entrainement
                    SportWorkout = TableauSport[compteur]
                    DateWorkout = ReturnDate(TableauDateWorkout[compteur])
                    DureeWorkout = TableauDureeWorkout[compteur]

                    // on cr√©er la card html
                    const CardWorkout = document.createElement("div")
                    CardWorkout.classList.add("card-recent-workout")

                    let CardWorkoutHTML = HTMLCard(CardWorkout, NameWorkout, SportWorkout, DateWorkout, DureeWorkout) // appelle a la fonction
                    ConteneurCardsWorkout.appendChild(CardWorkoutHTML)

                    compteur += 1 // incrementation
                });
            } 

            return
        }

        window.addEventListener("DOMContentLoaded", () => {
            AfficherData()
        })
    </script>


    <!-- Pour les outils favoris -->
    <script>
        const DicoNameIcon = { // dico avec le nom des outils et le nom de la class de l'icone
            "Charge d'entra√Ænement": "fs-icon_charge_entrainement",
            "Indulgence de course": "fs-icon_indulgence_course",
            "Estimation du temps de r√©cup√©ration": "fs-icon_temps_recup",

            "Zones cardiaques": "fs-icon_zones_cardiaques",
            "Prot√©ines quotidiennes": "fs-icon_proteines",
            "Calculateur IMC": "fs-icon_IMC",

            "Niveau course √† pied": "fs-icon_niveau_course",
            "Pr√©dicteur de performance": "fs-icon_predicteur_performance",
            "Estimation VMA": "fs-icon_VMA",
            "Estimation VO‚ÇÇmax": "fs-icon_VO2MAX",
            "Zones de vitesse": "fs-icon_zones_vitesse",
            "Zones de puissance": "fs-icon_zones_puissance",
            "Estimation puissance max. en course": "fs-icon_puissance_max",

            "Estimation 1RM": "fs-icon_1RM",

            "Estimation de la transpiration": "fs-icon_transpiration",
            "Estimation besoin d'hydratation": "fs-icon_besoin_hydratation",
            "Estimation puissance moy. en ski": "fs-icon_puissance_moy_ski",
            "Convertisseur km/miles": "fs-icon_miles_km"
        }

        const DicoNameHref = { // dico avec le nom des outils et le nom de la class de l'icone
            "Charge d'entra√Ænement": "Outils/Charge d'entra√Ænement/charge_entrainement.html",
            "Indulgence de course": "Outils/Indulgence de course/indulgence_course.html",
            "Estimation du temps de r√©cup√©ration": "Outils/Estimation du temps de r√©cup√©ration/estimation_temps_recuperation.html",

            "Zones cardiaques": "Outils/Zones cardiaques/zones_cardiaques.html",
            "Prot√©ines quotidiennes": "Outils/Prot√©ines quotidiennes/proteines_quotidienne.html",
            "Calculateur IMC": "Outils/Calculateur IMC/calculateur_imc.html",

            "Niveau course √† pied": "Outils/Niveau de course √† pied/niveau_course.html",
            "Pr√©dicteur de performance": "Outils/Pr√©dicteur de performance/predicteur_performance.html",
            "Estimation VMA": "Outils/Estimation VMA/estimation_vma.html",
            "Estimation VO‚ÇÇmax": "Outils/Estimation VO2max/estimation_VO2max.html",
            "Zones de vitesse": "Outils/Zones de vitesse/zones_vitesse.html",
            "Zones de puissance": "Outils/Zones de puissance/zones de puissance.html",
            "Estimation puissance max. en course": "Outils/Estimation puissance max en course/estimation_puissance_max_course.html",

            "Estimation 1RM": "Outils/Estimation 1RM/estimation_1RM.html",

            "Estimation de la transpiration": "Outils/Estimation de la transpiration/estimation_transpiration.html",
            "Estimation besoin d'hydratation": "Outils/Besoin d'hydratation quotidien/besoin_hydratation_quotidien.html",
            "Estimation puissance moy. en ski": "Outils/Estimation puissance moy en ski/estimation_puissance_moy_en_ski.html",
            "Convertisseur km/miles": "Outils/Convertisseur miles-km/convertisseur_miles_km.html"
        }

        function FavoriteTools() {
           let OutilFavorieUser = JSON.parse( localStorage.getItem("OutilsPin"))
        
           if (OutilFavorieUser.length > 0) {
                // changement du titre quand il y a des datas le titre passe de "Outils conseill√©s" => "Outils √©pingl√©s"
                document.getElementById("outils recent").textContent = "Outils √©pingl√©s"
                // on cache l'info bulle
                document.getElementById("info-bulle").style.display = "none"

                // on isole les valeurs
                let OutilFavoris1 = OutilFavorieUser[0]
                let OutilFavoris2 = OutilFavorieUser[1] || "Estimation VO‚ÇÇmax"
                let OutilFavoris3 = OutilFavorieUser[2] || "Niveau course √† pied"

                // si l'outil favoris 1 est estimation VO2max alors on met la charge d'entrainement (c pr √©viter d'avoir des doublons)
                if (OutilFavoris1 == OutilFavoris2) {
                    OutilFavoris2 = "Charge d'entra√Ænement"
                }
                if (OutilFavoris1 == OutilFavoris3) { // si l'outil favoris 2 est niveau course alors on met la charge d'entrainement (c pr √©viter d'avoir des doublons)
                    OutilFavoris3 = "Charge d'entra√Ænement"
                }

                // affichage des noms des outils favoris
                document.getElementById("P1").textContent = OutilFavoris1
                document.getElementById("P2").textContent = OutilFavoris2
                document.getElementById("P3").textContent = OutilFavoris3

                // Affichage de l'icone des outils favoris en cherchant dans le dico
                document.getElementById("I1").classList = ""
                document.getElementById("I1").classList.add(DicoNameIcon[OutilFavoris1])

                document.getElementById("I2").classList = ""
                document.getElementById("I2").classList.add(DicoNameIcon[OutilFavoris2])

                document.getElementById("I3").classList = ""
                document.getElementById("I3").classList.add(DicoNameIcon[OutilFavoris3])

                // attribution des liens
                document.getElementById("I1").parentElement.parentElement.href = DicoNameHref[OutilFavoris1]
                document.getElementById("I2").parentElement.parentElement.href = DicoNameHref[OutilFavoris2]
                document.getElementById("I3").parentElement.parentElement.href = DicoNameHref[OutilFavoris3]
           }

            return
        }

        window.addEventListener("DOMContentLoaded", () => {
            FavoriteTools()
        })
    </script>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            let PreferenceUser = localStorage.getItem("ToggleThemeComplet")
            let ModeUse = localStorage.getItem("ThemeActuel")
            
            if (PreferenceUser == "True") {
                // Recup des champs
                let ShortcutAdd = document.getElementById("icone-add")
                let ShortcutHistorique = document.getElementById("icone-historique")
                let ShortcutPause = document.getElementById("icone-pause")

                // Recup des icones
                let IconeShortcutAdd = document.querySelector(".fs-icon_add")
                let IconeShortcutHistorique = document.querySelector(".fs-icon_historique")
                let IconeShortcutPause = document.querySelector(".fs-icon_pause")

                // Recup variable css
                const Style = getComputedStyle(document.documentElement)

                const CouleurAccentHover = Style.getPropertyValue("--COULEUR_ACCENT_HOVER")
                const CouleurAccentContrasterHover = Style.getPropertyValue("--COULEUR_ACCENT_CONTRASTER_HOVER")
                const CouleurBackground = Style.getPropertyValue("--COULEUR_BACKGROUND")

                if (ShortcutAdd && ShortcutHistorique && ShortcutPause) {
                        if (ModeUse == "Clair") {
                            // Mise des couleurs si l'√©l√©ment est existant
                            ShortcutAdd.style.background = CouleurAccentContrasterHover
                            IconeShortcutAdd.style.color = CouleurBackground
                            
                            ShortcutHistorique.style.background = CouleurAccentContrasterHover
                            IconeShortcutHistorique.style.color = CouleurBackground

                            ShortcutPause.style.background = CouleurAccentContrasterHover
                            IconeShortcutPause.style.color = CouleurBackground
                        } else {
                            // Mise des couleurs si l'√©l√©ment est existant
                            ShortcutAdd.style.background = CouleurAccentHover
                            IconeShortcutAdd.style.color = CouleurBackground
                            
                            ShortcutHistorique.style.background = CouleurAccentHover
                            IconeShortcutHistorique.style.color = CouleurBackground

                            ShortcutPause.style.background = CouleurAccentHover
                            IconeShortcutPause.style.color = CouleurBackground
                        }
                }
            }
        })
    </script>

    <!-- Pour le JRM Coach -->
    <script>
        function PassageHeure(minutes) {
            let Heure = Math.floor(minutes/60) // Arrondi √† l'entier inf√©rieur
            let MinutesRestante = minutes-60*Heure

            // Initialisation
            let Result = ""
            if (Heure < 1) { // Si l'heure est inf√©rieur √† 1 on affiche que les minutes pour ne pas afficher 0h 23min
                Result = minutes
            } else { // Sinon on affiche tous
                Result = Heure + "h " + MinutesRestante.toString().padStart(2, "0")
            }
            
            return Result
        }

        async function JRMCoach() {
            // Recup data
            let HistoriqueDB = await db.entrainement.toArray()
            let CoachUserDB = await db.JRM_Coach.toArray()

            if (CoachUserDB.length > 0) { // Si il y a des datas on recup le nom et l'avatar et on l'affiche dans le coach JRM
                let NomCoach = CoachUserDB.map(elementDB => elementDB.nom)
                let AvatarCoach = CoachUserDB.map(elementDB => elementDB.avatar)
                
                document.getElementById("nom-coach").innerHTML =  AvatarCoach + " " + NomCoach + " :"
            }

            // Pour les statuts
            let StatutDB = await db.statut_analyse.toArray()

            if (StatutDB.length > 0) {
                let TableauStatut = StatutDB.map(elementDB => elementDB.statut).reverse()
                 // si il ny a pas de datas
                let TableauPhraseJRM = [
                    "Tu as signal√© que tu es en vacances ! Profite de ces jours de vacances pour te reposer et passer du temps avec ta famille,...",
                    "Tu as signal√© que tu es bless√©¬∑e ! Dans ces moments l√†, c'est compliqu√©, je le sais, mais si tu continues √† faire du sport en √©tant bless√©¬∑e, tu risques de retarder ta gu√©rison.",
                    "Tu as signal√© que tu es malade ! Je sais que c'est dur mais essaie de ne pas t'entra√Æner, car ton organisme a besoin de repos.",
                    "Tu as suspendu les analyses. Je ne peux donc pas analyser ta semaine d'entra√Ænement."
                ]
                let Interpretation = ""

                if (TableauStatut[0] != "Actif¬∑ve") { // si le statut n'est pas sur actif alors on met les interpretations
                    if (TableauStatut[0] == "Vacances") { // Attribution d'une interpretation en fonction du statut
                        Interpretation = TableauPhraseJRM[0]
                    } else if (TableauStatut[0] == "Blessure") {
                        Interpretation = TableauPhraseJRM[1]
                    } else if (TableauStatut[0] == "Malade") {
                        Interpretation = TableauPhraseJRM[2]
                    } else if (TableauStatut[0] == "Suspendre") {
                        Interpretation = TableauPhraseJRM[3]
                    }
                    // On affiche l'interpretation dans la zone du JRM
                    document.querySelector(".interpretation-jrm").innerHTML = Interpretation
                    return
                }
            }

            if (HistoriqueDB.length > 0) { // Si il y a des datas
                // Initialisation
                let DureeTotale = 0

                // Date moins 7 jours
                let DateActuelle = new Date()
                let DateMoins7J = new Date()

                DateMoins7J = DateMoins7J.setDate(DateActuelle.getDate() - 7) // pour le calcul des dates il faut les mettre en timestamp enleve le nb de j ici, √ßa renvoie ex: 1769014250809
                DateMoins7J = new Date(DateMoins7J).toISOString() // permet de recup "2026-01-21T17:13:53.151Z"
                // On prend que ce qui nous interesse donc la premiere partie
                DateMoins7J = DateMoins7J.split("T")[0] // on obtient "2026-01-21"

                // Recup du temps
                let TableauDate = HistoriqueDB.map(elementDB => elementDB.date)
                let TableauSport = HistoriqueDB.map(elementDB => elementDB.sport)

                let TableauDuree = HistoriqueDB.map(elementDB => elementDB.duree)
                let TableauDistance = HistoriqueDB.map(elementDB => elementDB.distance)
                let TableauDenivele = HistoriqueDB.map(elementDB => elementDB.denivele)

                // Initialisation pour la boucle
                let compteur = 0
                let NbWorkout = 0
                let NbWorkoutMuscu = 0

                // Innitialisation pour les distances
                let DistanceTotale = 0
                let DistanceTotaleCourse = 0
                let DistanceTotaleVelo = 0
                let DistanceTotaleMarche = 0

                let DeniveleTotale = 0

                let ExistenDataDistance = false // cette variable sera sur true si il y a des datas de distance pour que le JRM Coach les affiche
                // Prepa des variables pour recup les datas des diff√©rentes listes dans la boucle
                let DateElement = ""
                let DistanceElement = 0 
                let SportElement = ""

                // Parcour des donn√©es de la dur√©e
                TableauDuree.forEach(element => {
                    // Mise en variable des elements de chaque tableau qui correspondant au data de l'entrainement 
                    DateElement = TableauDate[compteur]
                    DistanceElement = TableauDistance[compteur]
                    DeniveleElement = TableauDenivele[compteur]
                    SportElement = TableauSport[compteur]

                    if (DateElement >= DateMoins7J) { // Si la date est plus lointaine que 7J on prend pas
                        DureeTotale += element // Ajout de la dur√©e qui est entrain d'√™tre parcourue
                        NbWorkout += 1 // Ajout de 1 pour calculer le nombre d'entra√Ænement

                        if (DistanceElement != null) { // Si il y a une distance dans cette s√©ance
                            ExistenDataDistance = true // Mise de la variable sur true pour que le coach affiche la distance dans son r√©sum√©
                            DistanceTotale += DistanceElement // ajout de la distance de la s√©ance
                                                        
                            // Ajout de la distance en fonction du sport
                            if (SportElement == "Course") {
                                DistanceTotaleCourse += DistanceElement // calcul distance totale en course
                            } else if (SportElement == "V√©lo") {
                                DistanceTotaleVelo += DistanceElement // calcul distance totale en v√©lo
                            } else if (SportElement == "Marche") {
                                DistanceTotaleMarche += DistanceElement // calcul distance totale en marche
                            }

                            DeniveleTotale += DeniveleElement
                        }

                        if (SportElement == "Musculation") { // si le sport c'est un de muscu on compte
                            NbWorkoutMuscu += 1 // Ajout de la s√©ance dans le compteur
                        }
                    }

                    compteur += 1 // incr√©mentation
                });

                const DureeTotaleHeure = PassageHeure(DureeTotale) // pour passer de 90 min √† 1h 30min

                // D√©but interpretation
                let Interpretation = `Au cours des 7 derniers jours, t'as fait :<br><br>
                                <strong>‚è±Ô∏è ${DureeTotaleHeure}min</strong> d'entra√Ænement<br>`
                
                if (NbWorkout == 1 || NbWorkout == 0) {
                    Interpretation += `<strong>üí™ ${NbWorkout} s√©ance</strong>`
                } else {
                    Interpretation += `<strong>üí™ ${NbWorkout} s√©ances</strong>`
                }
                
                // Si il y a des datas de distance
                if (ExistenDataDistance == true) {
                    Interpretation += `<br><br><strong>‚ÜîÔ∏è ${DistanceTotale.toFixed(1)} km</strong>` // Ajout de la distance totale peut importe le sport dans l'interpretation

                    // Tous ses if pour savoir quel est le sport que le user a le plus pratiqu√© cette semaine en fonction de la distance
                    if (DistanceTotaleCourse >= DistanceTotaleVelo && DistanceTotaleCourse >= DistanceTotaleMarche) {
                        if (DistanceTotaleCourse != 0) {
                            if (DistanceTotaleCourse == DistanceTotale) { // Si la distance de course est la meme que la distance totale on ajoute le sport a la fin
                                Interpretation += " de course √† pied"
                            } else {  
                                // cette interpretation pour que le user sache que sur 600 km parcourue cette semaine il en a fait 30 en course par exemple
                                Interpretation += `<br><strong>üèÉ ${DistanceTotaleCourse.toFixed(1)} km de course √† pied</strong>` 
                            }
                          
                        } 

                    } else if (DistanceTotaleVelo >= DistanceTotaleMarche) {
                        if (DistanceTotaleVelo != 0) {
                            if (DistanceTotaleVelo == DistanceTotale) { // Si la distance de v√©lo est la meme que la distance totale on ajoute le sport a la fin
                                Interpretation += " de v√©lo" 
                            } else {
                                // cette interpretation pour que le user sache que sur 600 km parcourue cette semaine il en a fait 30 de v√©lo par exemple
                                Interpretation += `<br><strong>üö¥ ${DistanceTotaleVelo.toFixed(1)} km de v√©lo</strong>`
                            }

                        }

                    } else {
                        if (DistanceTotaleMarche != 0) {
                            if (DistanceTotaleMarche == DistanceTotale) { // Si la distance de marche est la meme que la distance totale on ajoute le sport a la fin
                                Interpretation += " de marche"
                            } else {
                                // cette interpretation pour que le user sache que sur 600 km parcourue cette semaine il en a fait 30 en marche par exemple
                                Interpretation += `<br><strong>üö∂‚Äç‚ôÇÔ∏è ${DistanceTotaleMarche.toFixed(1)} km de marche</strong>`
                            }
                            
                        }

                    }
                    
                    if (DeniveleTotale > 0) { // Si le d√©nivel√© est sup√©rieur a 0 on l'affiche
                        Interpretation += `<br><strong>üèîÔ∏è ${DeniveleTotale} m</strong> de d√©nivel√©`
                    }
                }

                if (NbWorkoutMuscu != 0) { // Si il y a au moins une seance de muscu le coach l'affiche
                    if (NbWorkoutMuscu == 1) {
                        Interpretation += `<br><br><strong>üèãÔ∏è ${NbWorkoutMuscu} s√©ance de musculation</strong>`
                    } else {
                        Interpretation += `<br><br><strong>üèãÔ∏è ${NbWorkoutMuscu} s√©ances de musculation</strong>`
                    }
                }
                
                // Si les datas de dur√©e sont √©gale √† 0 alors petit message d'encouragement
                if (DureeTotale == 0) {
                    Interpretation += "<br><br>Essaie de prendre le temps de faire une s√©ance de sport, ton corps te remerciera plus tard. Si tu fais un entra√Ænement, m√™me l√©ger, tu dormiras mieux ce soir !"
                }

                document.querySelector(".interpretation-jrm").innerHTML = Interpretation // affichage dans le champs

            } else { // si il ny a pas de datas
                let NotData = `Je n'ai pas encore assez de donn√©es pour analyser ta semaine d'entra√Ænement. Continue tes efforts, j'ai h√¢te de voir tes permiers entra√Ænements !`

                document.querySelector(".interpretation-jrm").innerHTML = NotData
            }

            return
        }

        window.addEventListener("DOMContentLoaded", () => {
            JRMCoach()
        })
    </script>

    <script>
        function GenererNbAleatoire() {
            // Nb al√©atoire (formule * 17 fais avec gemini car en js clc les nb al√©atoire)
            let NombreAleatoire = Math.random()*16 // renvoie al√©atoirement entre 0 et 1 (ex : 0.5890953759539541) puis multiplication par 17
            NombreAleatoire = Math.floor(NombreAleatoire) //nb arrondi pour avoir par exemple 5.8 puis 5 grace a l'arrondi

            return NombreAleatoire
        }

        function TipsRandom() {
            let ParaTips = document.getElementById("tips")
            let NombreAleatoire = GenererNbAleatoire()

            // liste des tips
            const LiTips = [ // 16 Tips
                "Faites un test VMA puis d√©couvrez vos zones de vitesse pour optimiser vos entra√Ænements d'endurance et de fractionn√©,... Et donc progresser en course √† pied.",
                "Saviez-vous que vous pouviez estimer votre VO2max sans avoir de montre connect√©e gr√¢ce √† Sprintia.",
                "L'indulgence de course est la fonction parfaite pour s'am√©liorer en course √† pied !",
                "Saviez-vous qu'il existe dans Sprintia un 'Pr√©dicteur de performance' pour pr√©dire vos performances sur votre prochaine course.",
                "Si vous √™tes fatigu√©¬∑e vous pouvez mettre en pause les analyses de charge d'entra√Ænement,... Sprintia s'adapte √† votre √©tat de forme.",
                "Pour optimiser vos entra√Ænements, vous pouvez calculer vos zones de fr√©quence cardiaque depuis Sprintia avec une eexcllente pr√©cision gr√¢ce √† diff√©rentes m√©thodes de calcul.",
                "Saviez-vous que vous pouviez renommer le coach de l'application, tu peux m√™me choisir son style (Inshape, Copain, Strict & Motivant ou Bienveillant qui est le coach par d√©faut).",
                "Calculez les prot√©ines que vous devez manger par jour, c'est super pratique pour prendre en muscle et c'est disponible dans les outils de Sprintia.",
                "Dans l'historique des versions de Sprintia, vous pouvez d√©couvrir tous les moindres d√©tails de la derni√®re mise √† jour.",
                "Vous pouvez personnaliser Sprintia √† votre guise, par exemple vous pouvez choisir le th√®me 'feu' pour des couleurs √©clatantes ou le th√®me 'lune' pour avoir quelque chose de tr√®s sobre.",
                
                "Apr√®s un gros entra√Ænement, estimez votre temps de r√©cup√©ration gr√¢ce √† Sprintia. Le tout sans avoir besoin de montre connect√©e.",
                "Pour avoir un maximum de pr√©cision dans les outils, choisissez bien le RPE quand il est demand√© ne mettez pas au pif !",
                "D√©couvrez votre niveau de course en faisant un test Cooper. Apr√®s avoir fait ce test vous pourrez savoir si vous faites partie de l'√©lite !",
                "Apr√®s une s√©ance de sport, buvez, c'est important ! Pour savoir la quantit√© √† boire apr√®s votre entra√Ænement, je vous conseille de d'utiliser l'outil nomm√© : 'Estimation de la transpiration'.",
                "Vous ne savez toujours pas la charge maximale que vous pouvez soulever pour une unique r√©p√©tition ? Parfait, Sprintia le propose dans l'outil : 'Estimation 1RM'.",
                "Vous avez peur de perdre vos donn√©es en supprimant le cache de votre navigateur ? Pas de probl√®me, Sprintia vous propose de sauvegarder vos donn√©es dans les param√®tres."
            ]

            let TipsAleatoire = LiTips[NombreAleatoire]
            ParaTips.innerHTML = TipsAleatoire
            return
        }

        const DisplayBanniere = localStorage.getItem("DisplayBanniere")
        let MiseAvant = document.getElementById("banniere-accueil")

        if (DisplayBanniere == "False") {
            MiseAvant.style.display = "none"
        }

        const DisplayTips = localStorage.getItem("DisplayConseil")
        let ZoneTips = document.getElementById("banniere-tips")

        if (DisplayTips == "True") {
            ZoneTips.style.display = "flex"
            TipsRandom()
        } else {
            ZoneTips.style.display = "none"
        }
    </script>

    <!-- Pour le graphique -->
    <script>
        let DureeTotalSemaine = 0

        async function RecupData() {
            // Initialisation
            DureeTotalSemaine = 0 // Variable deja d√©fini en haut du script (remise √† 0)
            let DureeTotalSemaine2 = 0
            let DureeTotalSemaine3 = 0
    
            // Date recup
            const DateActuelle = new Date()

            let DateMoins7J = new Date()
            DateMoins7J = DateMoins7J.setDate(DateActuelle.getDate() - 7) // pour le calcul des dates il faut les mettre en timestamp enleve le nb de j ici, √ßa renvoie ex: 1769014250809
            DateMoins7J = new Date(DateMoins7J).toISOString() // permet de recup "2026-01-21T17:13:53.151Z"
            // On prend que ce qui nous interesse donc la premiere partie
            DateMoins7J = DateMoins7J.split("T")[0] // on obtient "2026-01-21"

            let DateMoins14J = new Date() // voir commentaire au dessus pr explication
            DateMoins14J = DateMoins14J.setDate(DateActuelle.getDate() - 14) 
            DateMoins14J = new Date(DateMoins14J).toISOString()
            DateMoins14J = DateMoins14J.split("T")[0] 

            let DateMoins21J = new Date() // voir commentaire au dessus pr explication
            DateMoins21J = DateMoins21J.setDate(DateActuelle.getDate() - 21) 
            DateMoins21J = new Date(DateMoins21J).toISOString()
            DateMoins21J = DateMoins21J.split("T")[0] 

            // Recup data in BDD
            const HistoriqueDB = await db.entrainement.toArray()

            // Trier par date 
            HistoriqueDB.sort((element1, element2) => { // En js on peut comparer 2 dates comme des maths
                if (element1.date < element2.date) return 1
                if (element1.date > element2.date) return -1
            })

            // Recup valeur qui nous interesse
            let DureeDataSemaine = HistoriqueDB.map(data => data.duree)
            let DateDataSemaine = HistoriqueDB.map(data => data.date)

            // Unit
            let TableauDureeSemaine = [] 
            let TableauDureeSemaine2 = [] 
            let TableauDureeSemaine3 = [] 
            let compteur = 0

            DateDataSemaine.forEach(element => { // Parcours des dates
                if (element >= DateMoins7J) {
                    TableauDureeSemaine.push(DureeDataSemaine[compteur]) // tableau pour la dur√©e des 7 derniers jours
                } else if (element >= DateMoins14J) {
                    TableauDureeSemaine2.push(DureeDataSemaine[compteur]) // tableau pour la dur√©e des 14 derniers jours (on ne compte pas les s√©ances des 7 premiers jours) 
                } else if (element >= DateMoins21J) {
                    TableauDureeSemaine3.push(DureeDataSemaine[compteur]) // tableau pour la dur√©e des 28 derniers jours (on ne compte pas les s√©ances des 14 premiers jours)
                }
                
                compteur += 1
            });

            // 3 boucles pour ajouter les dur√©e pr savoir jai fais combien de temps de sport les 7 derniers jours,...
            TableauDureeSemaine.forEach(element => { 
                DureeTotalSemaine += element
            })            
            TableauDureeSemaine2.forEach(element => {
                DureeTotalSemaine2 += element
            })
            TableauDureeSemaine3.forEach(element => {
                DureeTotalSemaine3 += element
            })

            const TableauPourGraphique = [DureeTotalSemaine3, DureeTotalSemaine2, DureeTotalSemaine]

            return TableauPourGraphique
        }

        // Initialisation de la variable du graphique pour que le code ce rappelle de l'ancien graphique "stock√©e" dans le BFCache 
        // Pr √©viter de superposer un graphique
        let barChart = null

        async function GenererGraphique() {
            // recup des datas
            let TableauPourGraphique = await RecupData()

            // Generation Graphique
            if (TableauPourGraphique.length > 0) { 
                // Ajout de la class pr le faire apparaitre
                document.getElementById("conteneur-graphique").classList.add("visible") // ce graphique en particulier est tout le temps visible meme si pas de donn√©es

                // R√©cup les variables css
                let RootCSS = document.documentElement
                let StyleCSS = getComputedStyle(RootCSS)
                // Recup variable css
                let CouleurAccentHover = StyleCSS.getPropertyValue("--COULEUR_ACCENT_HOVER")
                let CouleurAccent = StyleCSS.getPropertyValue("--COULEUR_ACCENT")
                let CouleurTextPrincipal = StyleCSS.getPropertyValue("--COULEUR_TEXT_PRINCIPAL")

                const barCanvas = document.getElementById("barCanvas")

                // Destruction de l'ancien graphique si il y en a un pour √©viter une superposition de graphique
                if (barChart) {
                    barChart.destroy()
                }

                barChart = new Chart(barCanvas, {
                        type:"line",
                        data:{
                            labels: ["S-3", "S-2", "S-1"],
                            datasets: [{
                                data: TableauPourGraphique,
                                borderColor : CouleurAccentHover, // Ligne des niveau couleur
                                backgroundColor: CouleurAccent,
                                fill: true, // Pour remplir le graphique de la couleur background
                                pointRadius: 8, // Taille du point
                                pointHoverRadius: 10,
                                pointBackgroundColor: CouleurAccentHover,
                                pointBorderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true, // Activation du responsive
                            maintainAspectRatio: false, // Tres important pour responsive sur mobile
                            
                            plugins: {
                                legend: {
                                    display: false // Masque la legende qui sert a rien dans mon cas
                                }
                            },
                            
                            scales: {
                                y: { // COuleur + taille des txt sur axe des ordonn√©es
                                    grid: {
                                        display: false // pr enlever la grille sur l'axe y (et x voir plus bas)
                                    },
                                    ticks: {
                                        color: CouleurTextPrincipal, 
                                        font: {size: 13}
                                    },
                                    beginAtZero: true, // Pr commencer √† 0
                                },
                                x: { // idem pour abscisse
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        color: CouleurTextPrincipal,
                                        font: {size: 13}
                                    }
                                }
                            }
                        }
                    })
                }
        }

        window.addEventListener("DOMContentLoaded", () => {
            GenererGraphique()
        })

        // Pour recharger le graphique si c'est dans le BFCache
        window.addEventListener("pageshow", (event) => {
            if (event.persisted) { // Si la page est dans le BFCache alors on relance le graphique
                GenererGraphique()
            }
        })
    </script>

    
    <!-- Pour avoir les statistiques de visite du site -->
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>